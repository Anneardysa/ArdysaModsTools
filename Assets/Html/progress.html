<!--
 * Copyright (C) 2026 Ardysa
 *
 * This program is free software: you can redistribute it and/or modify
 * it under the terms of the GNU General Public License as published by
 * the Free Software Foundation, either version 3 of the License, or
 * (at your option) any later version.
 *
 * This program is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU General Public License for more details.
 *
 * You should have received a copy of the GNU General Public License
 * along with this program.  If not, see <https://www.gnu.org/licenses/>.
 -->
<!doctype html>
<html lang="en">
   <head>
      <meta charset="UTF-8" />
      <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <title>Installing</title>
      <style>
         :root {
            --bg-primary: #000000;
            --bg-secondary: #050505;
            --bg-card: rgba(10, 10, 10, 0.9);
            --text-primary: #ffffff;
            --text-secondary: #888888;
            --text-muted: #444444;
            --border: #333333;
            --border-light: #222222;
            --accent: #ffffff;
            --accent-dim: rgba(255, 255, 255, 0.1);
            --green: #22c55e;
            --green-dim: rgba(34, 197, 94, 0.15);
         }

         * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
         }

         body {
            background: var(--bg-primary);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            font-family: "JetBrains Mono", monospace;
            color: var(--text-primary);
            overflow: hidden;
            position: relative;
         }

         /* ════════════════════════════════════════
            Animated Wave Background
            ════════════════════════════════════════ */
         .animated-bg {
            position: fixed;
            inset: 0;
            z-index: -1;
            overflow: hidden;
            background: var(--bg-primary);
         }

         .animated-bg::before {
            content: "";
            position: absolute;
            width: 200%;
            height: 100%;
            left: 0;
            top: 0;
            opacity: 0.08;
            background: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 1200 800' preserveAspectRatio='none'%3E%3Cpath fill='none' stroke='white' stroke-width='1.5' d='M0,400 C200,200 400,600 600,400 C800,200 1000,600 1200,400'/%3E%3C/svg%3E")
               repeat-x;
            background-size: 50% 100%;
            animation: infiniteWave 20s linear infinite;
         }

         @keyframes infiniteWave {
            0% {
               transform: translateX(0);
            }
            100% {
               transform: translateX(-50%);
            }
         }

         /* ════════════════════════════════════════
            Main Layout — Side-by-Side
            ════════════════════════════════════════ */
         .main-layout {
            display: flex;
            align-items: stretch;
            gap: 0;
            width: 100%;
            height: 100vh;
            position: relative;
            z-index: 1;
         }

         /* Left side: progress */
         .progress-side {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 32px;
            min-width: 0;
            position: relative;
         }

         /* Right side: preview (hidden by default) */
         .preview-side {
            display: none;
            width: 520px;
            flex-shrink: 0;
            border-left: 1px solid var(--border);
            flex-direction: column;
            overflow: hidden;
         }

         .preview-side.visible {
            display: flex;
         }

         /* ════════════════════════════════════════
            Progress Ring (Left Side)
            ════════════════════════════════════════ */
         .progress-ring-container {
            position: relative;
            width: 220px;
            height: 220px;
            margin: 0 auto 40px;
         }

         .progress-ring {
            transform: rotate(-90deg);
         }

         .progress-ring-bg {
            fill: none;
            stroke: var(--border);
            stroke-width: 2;
         }

         .progress-ring-fill {
            fill: none;
            stroke: var(--text-primary);
            stroke-width: 2;
            stroke-linecap: square;
            stroke-dasharray: 628.32;
            stroke-dashoffset: 628.32;
            transition: stroke-dashoffset 0.15s ease-out;
         }

         .percent-text {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 42px;
            font-weight: 700;
            color: var(--text-primary);
            letter-spacing: 3px;
         }

         .status {
            font-size: 14px;
            color: var(--text-secondary);
            margin-bottom: 12px;
            min-height: 26px;
            text-transform: uppercase;
            letter-spacing: 3px;
            text-align: center;
         }

         .status::before {
            content: "[ ";
            color: var(--text-muted);
         }

         .status::after {
            content: " ]";
            color: var(--text-muted);
         }

         .substatus {
            font-size: 11px;
            color: var(--text-muted);
            margin-bottom: 12px;
            min-height: 18px;
            max-width: 500px;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
            text-align: center;
         }

         .metrics-container {
            display: flex;
            justify-content: center;
            gap: 24px;
            margin-top: 10px;
            font-size: 11px;
            text-transform: uppercase;
            letter-spacing: 1px;
            color: var(--text-muted);
         }

         .metric-item {
            display: flex;
            align-items: center;
            gap: 8px;
         }

         .metric-label {
            color: var(--text-muted);
            opacity: 0.6;
         }

         .metric-value {
            color: var(--text-secondary);
            font-weight: bold;
            min-width: 80px;
            text-align: left;
         }

         .metric-value.active {
            color: var(--text-primary);
         }

         .credits {
            font-size: 12px;
            color: var(--text-muted);
            margin-top: 48px;
            text-transform: uppercase;
            letter-spacing: 3px;
            text-align: center;
         }

         .credits::before {
            content: "// ";
         }

         .download-progress {
            font-size: 12px;
            color: var(--text-secondary);
            margin-top: 16px;
            font-weight: bold;
            letter-spacing: 1px;
            text-align: center;
         }

         .download-progress #downloadedSize {
            color: var(--text-primary);
         }

         .download-progress #totalSize {
            color: var(--text-muted);
         }

         @keyframes pulse {
            0%,
            100% {
               opacity: 1;
            }
            50% {
               opacity: 0.5;
            }
         }

         .status.working {
            animation: pulse 2s ease-in-out infinite;
         }

         /* Corner Decorations — scoped to progress-side */
         .corner-decoration {
            position: absolute;
            width: 20px;
            height: 20px;
            border-color: var(--border);
            z-index: 10;
            pointer-events: none;
         }

         /* ════════════════════════════════════════
            Preview Panel (Right Side)
            ════════════════════════════════════════ */
         .preview-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 20px 20px 0;
            flex-shrink: 0;
         }

         .preview-title {
            display: flex;
            align-items: center;
            gap: 10px;
         }

         .preview-title-text {
            font-size: 11px;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 2px;
            color: var(--text-secondary);
         }

         .preview-count {
            font-size: 10px;
            padding: 3px 8px;
            border-radius: 10px;
            background: var(--green-dim);
            color: var(--green);
            border: 1px solid rgba(34, 197, 94, 0.3);
            font-weight: 600;
         }

         /* Search */
         .preview-search {
            padding: 12px 20px;
            flex-shrink: 0;
         }

         .preview-search-input {
            width: 100%;
            background: var(--bg-secondary);
            border: 1px solid var(--border);
            border-radius: 6px;
            padding: 8px 12px 8px 32px;
            font-family: inherit;
            font-size: 11px;
            color: var(--text-primary);
            outline: none;
            transition: border-color 0.2s;
         }

         .preview-search-input:focus {
            border-color: var(--text-secondary);
         }

         .preview-search-input::placeholder {
            color: var(--text-muted);
         }

         .preview-search-wrapper {
            position: relative;
         }

         .preview-search-icon {
            position: absolute;
            left: 10px;
            top: 50%;
            transform: translateY(-50%);
            width: 14px;
            height: 14px;
            color: var(--text-muted);
         }

         /* Grid */
         .preview-grid-wrapper {
            flex: 1;
            overflow-y: auto;
            padding: 4px 20px 20px;
         }

         .preview-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
         }

         /* Custom scrollbar */
         .preview-grid-wrapper::-webkit-scrollbar {
            width: 6px;
         }

         .preview-grid-wrapper::-webkit-scrollbar-track {
            background: transparent;
         }

         .preview-grid-wrapper::-webkit-scrollbar-thumb {
            background: var(--border);
            border-radius: 3px;
         }

         .preview-grid-wrapper::-webkit-scrollbar-thumb:hover {
            background: var(--text-muted);
         }

         /* Hero Card */
         .hero-preview-card {
            position: relative;
            border-radius: 6px;
            overflow: hidden;
            cursor: default;
            background: var(--bg-card);
            border: 1px solid var(--border-light);
            transition: all 0.25s ease;
         }

         .hero-preview-card:hover {
            border-color: rgba(34, 197, 94, 0.4);
            transform: translateY(-2px);
            box-shadow: 0 6px 16px rgba(0, 0, 0, 0.4);
         }

         .hero-preview-card:hover .hero-preview-img {
            transform: scale(1.05);
         }

         .hero-preview-img-wrapper {
            position: relative;
            height: 110px;
            overflow: hidden;
         }

         .hero-preview-img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            object-position: top;
            transition: transform 0.3s ease;
         }

         .hero-preview-gradient {
            position: absolute;
            inset: 0;
            background: linear-gradient(to top, rgba(0, 0, 0, 0.85) 0%, transparent 60%);
         }

         .hero-preview-name {
            position: absolute;
            bottom: 6px;
            left: 8px;
            right: 8px;
            font-size: 10px;
            font-weight: 600;
            color: white;
            text-transform: capitalize;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            letter-spacing: 0.5px;
         }

         /* States */
         .preview-loading,
         .preview-error,
         .preview-empty {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 40px 20px;
            text-align: center;
            color: var(--text-muted);
            flex: 1;
         }

         .preview-loading-dots {
            display: flex;
            gap: 6px;
            margin-bottom: 16px;
         }

         .preview-loading-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: var(--text-muted);
            animation: loadDot 1.4s ease-in-out infinite;
         }

         .preview-loading-dot:nth-child(2) {
            animation-delay: 0.2s;
         }
         .preview-loading-dot:nth-child(3) {
            animation-delay: 0.4s;
         }

         @keyframes loadDot {
            0%,
            80%,
            100% {
               opacity: 0.3;
               transform: scale(0.8);
            }
            40% {
               opacity: 1;
               transform: scale(1);
            }
         }

         .preview-error-icon {
            width: 32px;
            height: 32px;
            margin-bottom: 12px;
            color: var(--text-muted);
         }

         .preview-state-text {
            font-size: 11px;
            letter-spacing: 1px;
            text-transform: uppercase;
         }

         .preview-state-sub {
            font-size: 10px;
            margin-top: 6px;
            color: var(--text-muted);
            opacity: 0.6;
         }

         /* Skeleton loader */
         .skeleton-card {
            border-radius: 6px;
            overflow: hidden;
            background: var(--bg-card);
            border: 1px solid var(--border-light);
         }

         .skeleton-img {
            height: 110px;
            background: linear-gradient(90deg, #111 25%, #1a1a1a 50%, #111 75%);
            background-size: 200% 100%;
            animation: shimmer 1.5s infinite;
         }

         @keyframes shimmer {
            0% {
               background-position: 200% 0;
            }
            100% {
               background-position: -200% 0;
            }
         }

         /* ════════════════════════════════════════
            Lightbox
            ════════════════════════════════════════ */
         .lightbox {
            display: none;
            position: fixed;
            inset: 0;
            z-index: 100;
            background: rgba(0, 0, 0, 0.92);
            align-items: center;
            justify-content: center;
            cursor: pointer;
         }

         .lightbox.active {
            display: flex;
         }

         .lightbox-content {
            position: relative;
            max-width: 90%;
            max-height: 90%;
         }

         .lightbox-img {
            max-width: 100%;
            max-height: 85vh;
            border-radius: 8px;
            border: 1px solid var(--border);
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.6);
         }

         .lightbox-name {
            text-align: center;
            margin-top: 12px;
            font-size: 14px;
            font-weight: 600;
            text-transform: capitalize;
            letter-spacing: 2px;
            color: var(--text-secondary);
         }

         /* ════════════════════════════════════════
            Cancel Button (bottom center)
            ════════════════════════════════════════ */
         .cancel-container {
            position: absolute;
            bottom: 12px;
            left: 0;
            right: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 10;
            pointer-events: none;
         }

         .cancel-btn {
            pointer-events: auto;
            background: transparent;
            color: var(--text-muted);
            border: 1px solid var(--border);
            font-family: "JetBrains Mono", monospace;
            font-size: 11px;
            font-weight: 700;
            letter-spacing: 2px;
            text-transform: uppercase;
            padding: 10px 28px;
            cursor: pointer;
            transition: all 0.15s ease;
         }

         .cancel-btn:hover {
            color: var(--text-primary);
            border-color: var(--text-secondary);
            background: rgba(255, 255, 255, 0.05);
         }
      </style>
   </head>

   <body>
      <div class="animated-bg"></div>

      <!-- Main Layout -->
      <div class="main-layout">
         <!-- Left: Progress -->
         <div class="progress-side">
            <!-- Corner decorations (scoped to progress container) -->
            <div
               class="corner-decoration"
               style="top: 16px; left: 16px; border-top: 1px solid; border-left: 1px solid"
            ></div>
            <div
               class="corner-decoration"
               style="top: 16px; right: 16px; border-top: 1px solid; border-right: 1px solid"
            ></div>
            <div
               class="corner-decoration"
               style="bottom: 50px; left: 16px; border-bottom: 1px solid; border-left: 1px solid"
            ></div>
            <div
               class="corner-decoration"
               style="bottom: 50px; right: 16px; border-bottom: 1px solid; border-right: 1px solid"
            ></div>
            <div class="progress-ring-container">
               <svg class="progress-ring" width="220" height="220">
                  <circle class="progress-ring-bg" cx="110" cy="110" r="100" />
                  <circle class="progress-ring-fill" id="progressRing" cx="110" cy="110" r="100" />
               </svg>
               <div class="percent-text" id="percent">0%</div>
            </div>

            <div class="status working" id="status">Preparing</div>
            <div class="substatus" id="substatus"></div>

            <!-- Download progress: 0/120MB or file count -->
            <div class="download-progress" id="downloadProgress" style="display: none">
               <span id="downloadedSize">0</span> / <span id="totalSize">0</span
               ><span id="progressUnit"> MB</span>
            </div>

            <div class="metrics-container">
               <div class="metric-item">
                  <span class="metric-label">DL Speed:</span>
                  <span class="metric-value" id="dlSpeed">-- MB/S</span>
               </div>
            </div>

            <div class="credits">made with ❤️</div>

            <!-- Cancel Button (scoped to progress container) -->
            <div class="cancel-container">
               <button class="cancel-btn" id="cancelBtn" onclick="requestCancel()">
                  [ CANCEL ]
               </button>
            </div>
         </div>

         <!-- Right: Preview Panel (hidden by default) -->
         <div class="preview-side" id="previewSide">
            <!-- Header -->
            <div class="preview-header">
               <div class="preview-title">
                  <span class="preview-title-text">ModsPack Preview</span>
                  <span class="preview-count" id="previewCount">...</span>
               </div>
            </div>

            <!-- Search -->
            <div class="preview-search">
               <div class="preview-search-wrapper">
                  <svg
                     class="preview-search-icon"
                     fill="none"
                     stroke="currentColor"
                     viewBox="0 0 24 24"
                  >
                     <path
                        stroke-linecap="round"
                        stroke-linejoin="round"
                        stroke-width="2"
                        d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"
                     />
                  </svg>
                  <input
                     type="text"
                     class="preview-search-input"
                     id="previewSearch"
                     placeholder="Search heroes..."
                  />
               </div>
            </div>

            <!-- Grid (scrollable) -->
            <div class="preview-grid-wrapper" id="previewGridWrapper">
               <!-- Loading state (shown initially) -->
               <div class="preview-loading" id="previewLoading">
                  <div class="preview-loading-dots">
                     <div class="preview-loading-dot"></div>
                     <div class="preview-loading-dot"></div>
                     <div class="preview-loading-dot"></div>
                  </div>
                  <div class="preview-state-text">Loading preview</div>
                  <div class="preview-state-sub">Fetching hero skins from server...</div>
               </div>

               <!-- Error state (hidden) -->
               <div class="preview-error" id="previewError" style="display: none">
                  <svg
                     class="preview-error-icon"
                     fill="none"
                     stroke="currentColor"
                     viewBox="0 0 24 24"
                  >
                     <path
                        stroke-linecap="round"
                        stroke-linejoin="round"
                        stroke-width="1.5"
                        d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"
                     />
                  </svg>
                  <div class="preview-state-text">Preview unavailable</div>
                  <div class="preview-state-sub" id="previewErrorText">
                     Could not load preview data
                  </div>
               </div>

               <!-- Empty search state (hidden) -->
               <div class="preview-empty" id="previewEmpty" style="display: none">
                  <div class="preview-state-text">No heroes found</div>
                  <div class="preview-state-sub">Try a different search term</div>
               </div>

               <!-- Hero grid (hidden until loaded) -->
               <div class="preview-grid" id="previewGrid" style="display: none"></div>
            </div>
         </div>
      </div>

      <!-- Lightbox -->
      <div class="lightbox" id="lightbox" onclick="closeLightbox()">
         <div class="lightbox-content" onclick="event.stopPropagation()">
            <img class="lightbox-img" id="lightboxImg" src="" alt="" />
            <div class="lightbox-name" id="lightboxName"></div>
         </div>
      </div>

      <script>
         /* ════════════════════════════════════════
            Existing Progress Functions (unchanged API)
            ════════════════════════════════════════ */
         const circumference = 628.32;

         function updateProgress(percent) {
            const ring = document.getElementById("progressRing");
            const percentText = document.getElementById("percent");
            const offset = circumference - (percent / 100) * circumference;
            ring.style.strokeDashoffset = offset;
            percentText.textContent = Math.round(percent) + "%";
            if (percent >= 100) {
               updateDownloadSpeed("-- MB/S");
               hideDownloadProgress();
            }
         }

         function updateStatus(text) {
            document.getElementById("status").textContent = text;
         }

         function updateSubstatus(text) {
            const el = document.getElementById("substatus");
            if (el) el.textContent = text;
         }

         function updateDownloadSpeed(speed) {
            const el = document.getElementById("dlSpeed");
            el.textContent = speed;
            if (speed !== "-- MB/S" && speed !== "0.0 MB/S") {
               el.classList.add("active");
            } else {
               el.classList.remove("active");
            }
         }

         function updateWriteSpeed(speed) {}

         function updateDownloadProgress(downloadedMB, totalMB) {
            const container = document.getElementById("downloadProgress");
            const downloadedEl = document.getElementById("downloadedSize");
            const totalEl = document.getElementById("totalSize");
            if (totalMB > 0) {
               container.style.display = "block";
               downloadedEl.textContent = downloadedMB.toFixed(1);
               totalEl.textContent = totalMB.toFixed(1);
               document.getElementById("progressUnit").textContent = " MB";
            } else {
               container.style.display = "none";
            }
         }

         function hideDownloadProgress() {
            const container = document.getElementById("downloadProgress");
            const metricsContainer = document.querySelector(".metrics-container");
            if (container) container.style.display = "none";
            if (metricsContainer) metricsContainer.style.display = "none";
         }

         function updateFileProgress(current, total) {
            const container = document.getElementById("downloadProgress");
            const downloadedEl = document.getElementById("downloadedSize");
            const totalEl = document.getElementById("totalSize");
            const unitEl = document.getElementById("progressUnit");
            if (total > 0) {
               container.style.display = "block";
               downloadedEl.textContent = current;
               totalEl.textContent = total;
               unitEl.textContent = " files";
            } else {
               container.style.display = "none";
            }
         }

         /* Cancel via WebView2 message bridge */
         function requestCancel() {
            if (window.chrome && window.chrome.webview) {
               window.chrome.webview.postMessage("cancel");
            }
         }

         function hideCancel() {
            const c = document.querySelector(".cancel-container");
            if (c) c.style.display = "none";
         }

         /* ════════════════════════════════════════
            Preview Panel Functions
            ════════════════════════════════════════ */
         const IMAGE_BASE_URL =
            "https://raw.githubusercontent.com/Anneardysa/ArdysaMods/main/assets/updates/";

         let allHeroes = [];
         let currentFilter = "";

         /**
          * Initialize preview panel with hero data.
          * Called from C# after fetching hero list from GitHub API.
          * @param {Array<{name: string, file: string}>} heroes
          */
         function initPreview(heroes) {
            allHeroes = heroes;

            // Show the preview panel
            document.getElementById("previewSide").classList.add("visible");

            // Update count
            document.getElementById("previewCount").textContent = heroes.length + " skins";

            // Hide loading, show grid
            document.getElementById("previewLoading").style.display = "none";
            document.getElementById("previewGrid").style.display = "grid";

            // Render
            renderHeroes(heroes);

            // Wire up search
            document.getElementById("previewSearch").addEventListener("input", function () {
               currentFilter = this.value.toLowerCase().trim();
               filterHeroes();
            });
         }

         /**
          * Show the preview panel in loading state (before data arrives).
          * Called from C# immediately to show the wider layout.
          */
         function showPreviewLoading() {
            document.getElementById("previewSide").classList.add("visible");
         }

         /**
          * Show error state if preview data could not be fetched.
          * Called from C# on fetch failure.
          * @param {string} message
          */
         function showPreviewError(message) {
            document.getElementById("previewSide").classList.add("visible");
            document.getElementById("previewLoading").style.display = "none";
            document.getElementById("previewGrid").style.display = "none";
            document.getElementById("previewEmpty").style.display = "none";

            const errorEl = document.getElementById("previewError");
            errorEl.style.display = "flex";
            document.getElementById("previewErrorText").textContent =
               message || "Could not load preview data";
         }

         function renderHeroes(heroes) {
            const grid = document.getElementById("previewGrid");
            grid.innerHTML = "";

            heroes.forEach(function (hero) {
               const card = document.createElement("div");
               card.className = "hero-preview-card";
               card.setAttribute("data-name", hero.name.toLowerCase());
               card.onclick = function () {
                  openLightbox(hero);
               };

               card.innerHTML =
                  '<div class="hero-preview-img-wrapper">' +
                  '<img class="hero-preview-img" src="' +
                  IMAGE_BASE_URL +
                  hero.file +
                  '"' +
                  ' alt="' +
                  hero.name +
                  '" loading="lazy"' +
                  " onerror=\"this.style.display='none'\" />" +
                  '<div class="hero-preview-gradient"></div>' +
                  '<div class="hero-preview-name">' +
                  hero.name +
                  "</div>" +
                  "</div>";

               grid.appendChild(card);
            });
         }

         function filterHeroes() {
            if (!currentFilter) {
               renderHeroes(allHeroes);
               document.getElementById("previewEmpty").style.display = "none";
               document.getElementById("previewGrid").style.display = "grid";
               return;
            }

            const filtered = allHeroes.filter(function (h) {
               return h.name.toLowerCase().includes(currentFilter);
            });

            if (filtered.length === 0) {
               document.getElementById("previewGrid").style.display = "none";
               document.getElementById("previewEmpty").style.display = "flex";
            } else {
               document.getElementById("previewEmpty").style.display = "none";
               document.getElementById("previewGrid").style.display = "grid";
               renderHeroes(filtered);
            }
         }

         /* ════════════════════════════════════════
            Lightbox
            ════════════════════════════════════════ */
         function openLightbox(hero) {
            const img = document.getElementById("lightboxImg");
            const name = document.getElementById("lightboxName");
            img.src = IMAGE_BASE_URL + hero.file;
            img.alt = hero.name;
            name.textContent = hero.name;
            document.getElementById("lightbox").classList.add("active");
         }

         function closeLightbox() {
            document.getElementById("lightbox").classList.remove("active");
            document.getElementById("lightboxImg").src = "";
         }

         // ESC closes lightbox
         document.addEventListener("keydown", function (e) {
            if (e.key === "Escape") closeLightbox();
         });
      </script>
   </body>
</html>
