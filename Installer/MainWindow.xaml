<Window x:Class="ArdysaModsTools.Installer.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        Title="ArdysaModsTools Setup"
        Width="420" Height="560"
        WindowStyle="None"
        AllowsTransparency="True"
        Background="Transparent"
        ResizeMode="NoResize"
        WindowStartupLocation="CenterScreen"
        MouseLeftButtonDown="Window_MouseLeftButtonDown"
        Loaded="Window_Loaded">

    <!-- ============================================ -->
    <!-- MAIN CONTAINER (Rounded, Dark Background)   -->
    <!-- ============================================ -->
    <Border x:Name="MainBorder"
            CornerRadius="16"
            Background="{StaticResource BgPrimary}"
            BorderBrush="{StaticResource BorderBrush}"
            BorderThickness="1"
            Padding="0"
            RenderTransformOrigin="0.5,0.5">
        <Border.Effect>
            <DropShadowEffect BlurRadius="30" ShadowDepth="0" Opacity="0.6" Color="Black" />
        </Border.Effect>
        <Border.RenderTransform>
            <ScaleTransform ScaleX="1" ScaleY="1" />
        </Border.RenderTransform>

        <Grid>
            <Grid.RowDefinitions>
                <RowDefinition Height="40" />   <!-- Title bar -->
                <RowDefinition Height="*" />    <!-- Content -->
            </Grid.RowDefinitions>

            <!-- ======================================== -->
            <!-- CUSTOM TITLE BAR                         -->
            <!-- ======================================== -->
            <Grid Grid.Row="0" Background="Transparent">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*" />
                    <ColumnDefinition Width="Auto" />
                </Grid.ColumnDefinitions>

                <!-- Close Button -->
                <Button Grid.Column="1"
                        x:Name="CloseButton"
                        Click="CloseButton_Click"
                        Width="40" Height="40"
                        VerticalAlignment="Top"
                        HorizontalAlignment="Right">
                    <Button.Template>
                        <ControlTemplate TargetType="Button">
                            <Border x:Name="CloseBorder"
                                    Background="Transparent"
                                    CornerRadius="0,16,0,0"
                                    Width="40" Height="40"
                                    Cursor="Hand">
                                <TextBlock Text="✕"
                                           x:Name="CloseText"
                                           Foreground="{StaticResource TextMuted}"
                                           FontSize="14"
                                           HorizontalAlignment="Center"
                                           VerticalAlignment="Center" />
                            </Border>
                            <ControlTemplate.Triggers>
                                <Trigger Property="IsMouseOver" Value="True">
                                    <Setter TargetName="CloseBorder" Property="Background" Value="#3FF85149" />
                                    <Setter TargetName="CloseText" Property="Foreground" Value="{StaticResource ErrorBrush}" />
                                </Trigger>
                            </ControlTemplate.Triggers>
                        </ControlTemplate>
                    </Button.Template>
                </Button>
            </Grid>

            <!-- ======================================== -->
            <!-- CONTENT AREA                             -->
            <!-- ======================================== -->
            <Grid Grid.Row="1" Margin="40,0,40,24">
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto" />  <!-- Logo -->
                    <RowDefinition Height="Auto" />  <!-- Title + Version -->
                    <RowDefinition Height="*" />     <!-- Spacer -->
                    <RowDefinition Height="Auto" />  <!-- Button / Progress / Complete / Error -->
                    <RowDefinition Height="Auto" />  <!-- Advanced panel -->
                    <RowDefinition Height="Auto" />  <!-- Status text -->
                    <RowDefinition Height="12" />    <!-- Spacer -->
                    <RowDefinition Height="Auto" />  <!-- Footer -->
                </Grid.RowDefinitions>

                <!-- ======================================== -->
                <!-- LOGO (Accent colored sparkle)            -->
                <!-- ======================================== -->
                <TextBlock Grid.Row="0"
                           x:Name="LogoText"
                           Text="✦"
                           FontSize="64"
                           Foreground="{StaticResource AccentBrush}"
                           HorizontalAlignment="Center"
                           Margin="0,12,0,0"
                           RenderTransformOrigin="0.5,0.5">
                    <TextBlock.RenderTransform>
                        <ScaleTransform ScaleX="1" ScaleY="1" />
                    </TextBlock.RenderTransform>
                </TextBlock>

                <!-- ======================================== -->
                <!-- TITLE + VERSION                          -->
                <!-- ======================================== -->
                <StackPanel Grid.Row="1" HorizontalAlignment="Center" Margin="0,12,0,0">
                    <TextBlock Text="ArdysaModsTools"
                               FontSize="24"
                               FontWeight="Bold"
                               FontFamily="{StaticResource PrimaryFont}"
                               Foreground="{StaticResource TextPrimary}"
                               HorizontalAlignment="Center" />
                    <TextBlock x:Name="SubtitleText"
                               Text="Setup"
                               FontSize="14"
                               FontFamily="{StaticResource PrimaryFont}"
                               Foreground="{StaticResource TextSecondary}"
                               HorizontalAlignment="Center"
                               Margin="0,4,0,0" />
                    <!-- Version badge (shown for both fresh install and update) -->
                    <TextBlock x:Name="VersionText"
                               FontSize="12"
                               FontFamily="{StaticResource PrimaryFont}"
                               Foreground="{StaticResource AccentLightBrush}"
                               HorizontalAlignment="Center"
                               Margin="0,6,0,0"
                               Visibility="Collapsed" />
                </StackPanel>

                <!-- ======================================== -->
                <!-- INSTALL BUTTON (visible initially)       -->
                <!-- ======================================== -->
                <StackPanel Grid.Row="3"
                            x:Name="InstallPanel"
                            HorizontalAlignment="Center"
                            Visibility="Visible">
                    <Button x:Name="InstallButton"
                            Content="Install Now"
                            Style="{StaticResource InstallButton}"
                            Click="InstallButton_Click"
                            Width="280" />

                    <TextBlock x:Name="SizeText"
                               Text="~90 MB"
                               FontSize="12"
                               FontFamily="{StaticResource PrimaryFont}"
                               Foreground="{StaticResource TextMuted}"
                               HorizontalAlignment="Center"
                               Margin="0,10,0,0" />

                    <!-- Advanced options toggle -->
                    <Button x:Name="AdvancedToggle"
                            Content="Advanced Options"
                            Style="{StaticResource AdvancedToggle}"
                            Click="AdvancedToggle_Click"
                            HorizontalAlignment="Center"
                            Margin="0,8,0,0" />
                </StackPanel>

                <!-- ======================================== -->
                <!-- ADVANCED INSTALL PANEL (hidden by def.)  -->
                <!-- ======================================== -->
                <StackPanel Grid.Row="4"
                            x:Name="AdvancedPanel"
                            Visibility="Collapsed"
                            Margin="0,12,0,0">
                    <TextBlock Text="Install Location"
                               FontSize="11"
                               FontWeight="SemiBold"
                               FontFamily="{StaticResource PrimaryFont}"
                               Foreground="{StaticResource TextSecondary}"
                               Margin="0,0,0,6" />
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*" />
                            <ColumnDefinition Width="8" />
                            <ColumnDefinition Width="Auto" />
                        </Grid.ColumnDefinitions>
                        <TextBox x:Name="PathTextBox"
                                 Style="{StaticResource PathTextBox}"
                                 Grid.Column="0" />
                        <Button x:Name="BrowseButton"
                                Content="Browse"
                                Style="{StaticResource BrowseButton}"
                                Click="BrowseButton_Click"
                                Grid.Column="2" />
                    </Grid>
                    <TextBlock x:Name="DiskSpaceText"
                               FontSize="10"
                               FontFamily="{StaticResource PrimaryFont}"
                               Foreground="{StaticResource TextMuted}"
                               Margin="0,6,0,0" />
                </StackPanel>

                <!-- ======================================== -->
                <!-- PROGRESS UI (hidden initially)           -->
                <!-- ======================================== -->
                <StackPanel Grid.Row="3"
                            x:Name="ProgressPanel"
                            Visibility="Collapsed"
                            Opacity="0"
                            HorizontalAlignment="Stretch">

                    <ProgressBar x:Name="InstallProgress"
                                 Style="{StaticResource ModernProgressBar}"
                                 Minimum="0" Maximum="100" Value="0"
                                 Margin="0,8" />

                    <TextBlock x:Name="ProgressText"
                               Text="Preparing..."
                               FontSize="13"
                               FontFamily="{StaticResource PrimaryFont}"
                               Foreground="{StaticResource TextSecondary}"
                               HorizontalAlignment="Center"
                               Margin="0,8,0,0" />

                    <TextBlock x:Name="ProgressPercent"
                               Text="0%"
                               FontSize="28"
                               FontWeight="SemiBold"
                               FontFamily="{StaticResource PrimaryFont}"
                               Foreground="{StaticResource TextPrimary}"
                               HorizontalAlignment="Center"
                               Margin="0,4,0,0" />
                </StackPanel>

                <!-- ======================================== -->
                <!-- COMPLETION UI (hidden initially)         -->
                <!-- ======================================== -->
                <StackPanel Grid.Row="3"
                            x:Name="CompletePanel"
                            Visibility="Collapsed"
                            Opacity="0"
                            HorizontalAlignment="Center">

                    <TextBlock x:Name="CompleteIcon"
                               Text="✓"
                               FontSize="48"
                               Foreground="{StaticResource SuccessBrush}"
                               HorizontalAlignment="Center"
                               RenderTransformOrigin="0.5,0.5">
                        <TextBlock.RenderTransform>
                            <ScaleTransform ScaleX="1" ScaleY="1" />
                        </TextBlock.RenderTransform>
                    </TextBlock>

                    <TextBlock x:Name="CompleteText"
                               Text="Installation Complete!"
                               FontSize="16"
                               FontWeight="SemiBold"
                               FontFamily="{StaticResource PrimaryFont}"
                               Foreground="{StaticResource TextPrimary}"
                               HorizontalAlignment="Center"
                               Margin="0,8,0,0" />

                    <Button x:Name="LaunchButton"
                            Content="Launch"
                            Style="{StaticResource InstallButton}"
                            Click="LaunchButton_Click"
                            Width="200"
                            Margin="0,20,0,0" />
                </StackPanel>

                <!-- ======================================== -->
                <!-- ERROR UI (hidden initially)              -->
                <!-- ======================================== -->
                <StackPanel Grid.Row="3"
                            x:Name="ErrorPanel"
                            Visibility="Collapsed"
                            Opacity="0"
                            HorizontalAlignment="Center"
                            RenderTransformOrigin="0.5,0.5">

                    <TextBlock Text="✕"
                               FontSize="48"
                               Foreground="{StaticResource ErrorBrush}"
                               HorizontalAlignment="Center" />

                    <TextBlock x:Name="ErrorText"
                               Text="Installation Failed"
                               FontSize="14"
                               FontFamily="{StaticResource PrimaryFont}"
                               Foreground="{StaticResource ErrorBrush}"
                               HorizontalAlignment="Center"
                               TextWrapping="Wrap"
                               TextAlignment="Center"
                               Margin="0,8,0,0" />

                    <Button x:Name="RetryButton"
                            Content="Retry"
                            Style="{StaticResource InstallButton}"
                            Click="InstallButton_Click"
                            Width="200"
                            Margin="0,20,0,0" />
                </StackPanel>

                <!-- ======================================== -->
                <!-- STATUS TEXT                              -->
                <!-- ======================================== -->
                <TextBlock Grid.Row="5"
                           x:Name="StatusText"
                           FontSize="11"
                           FontFamily="{StaticResource PrimaryFont}"
                           Foreground="{StaticResource TextMuted}"
                           HorizontalAlignment="Center"
                           TextWrapping="Wrap"
                           TextAlignment="Center"
                           Margin="0,10,0,0" />

                <!-- ======================================== -->
                <!-- FOOTER (License Link)                    -->
                <!-- ======================================== -->
                <StackPanel Grid.Row="7"
                            Orientation="Horizontal"
                            HorizontalAlignment="Center">
                    <TextBlock FontSize="11"
                               FontFamily="{StaticResource PrimaryFont}"
                               Foreground="{StaticResource TextMuted}">
                        <Run Text="By installing, you agree to the " />
                        <Hyperlink x:Name="LicenseLink"
                                   Click="LicenseLink_Click"
                                   Foreground="{StaticResource AccentLightBrush}"
                                   TextDecorations="None">
                            <Run Text="License" />
                        </Hyperlink>
                    </TextBlock>
                </StackPanel>
            </Grid>

            <!-- ======================================== -->
            <!-- LICENSE MODAL OVERLAY                    -->
            <!-- ======================================== -->
            <Grid Grid.Row="0" Grid.RowSpan="2"
                  x:Name="LicenseModal"
                  Visibility="Collapsed"
                  Opacity="0">

                <!-- Semi-transparent backdrop -->
                <Border Background="{StaticResource ModalOverlay}"
                        CornerRadius="16"
                        MouseLeftButtonDown="LicenseBackdrop_Click" />

                <!-- Modal content card -->
                <Border Background="{StaticResource BgSecondary}"
                        CornerRadius="12"
                        BorderBrush="{StaticResource BorderBrush}"
                        BorderThickness="1"
                        Margin="24,32,24,32"
                        Padding="20"
                        VerticalAlignment="Stretch"
                        RenderTransformOrigin="0.5,0.5">
                    <Border.RenderTransform>
                        <ScaleTransform ScaleX="1" ScaleY="1" />
                    </Border.RenderTransform>
                    <Border.Effect>
                        <DropShadowEffect BlurRadius="20" ShadowDepth="0" Opacity="0.4" Color="Black" />
                    </Border.Effect>

                    <Grid>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto" />  <!-- Header -->
                            <RowDefinition Height="*" />     <!-- Scrollable body -->
                            <RowDefinition Height="Auto" />  <!-- Close button -->
                        </Grid.RowDefinitions>

                        <!-- Modal Header -->
                        <StackPanel Grid.Row="0" Margin="0,0,0,12">
                            <TextBlock Text="License Agreement"
                                       FontSize="18"
                                       FontWeight="Bold"
                                       FontFamily="{StaticResource PrimaryFont}"
                                       Foreground="{StaticResource TextPrimary}" />
                            <TextBlock Text="GNU General Public License v3.0"
                                       FontSize="11"
                                       FontFamily="{StaticResource PrimaryFont}"
                                       Foreground="{StaticResource TextMuted}"
                                       Margin="0,4,0,0" />
                        </StackPanel>

                        <!-- Scrollable License Text -->
                        <ScrollViewer Grid.Row="1"
                                      VerticalScrollBarVisibility="Auto"
                                      HorizontalScrollBarVisibility="Disabled"
                                      Padding="0,0,8,0">
                            <TextBlock x:Name="LicenseText"
                                       TextWrapping="Wrap"
                                       FontSize="11"
                                       FontFamily="Consolas, Courier New"
                                       Foreground="{StaticResource TextSecondary}"
                                       LineHeight="18" />
                        </ScrollViewer>

                        <!-- Close Button -->
                        <Button Grid.Row="2"
                                Content="Close"
                                Style="{StaticResource ModalCloseButton}"
                                Click="LicenseClose_Click"
                                HorizontalAlignment="Right"
                                Margin="0,12,0,0" />
                    </Grid>
                </Border>
            </Grid>

        </Grid>
    </Border>

</Window>
